---
import Base from "../layouts/Base.astro";
import MyHero from "components/MyHero.astro";
import AboutSections from "components/AboutSections.astro";
import Contact from "components/Contact.astro";
import Footer from "components/Footer.astro";
---

<Base
  title="Yeison Liscano"
  description="Security engineer building solutions with AWS, Python, TypeScript and React. Focused on AI-driven products."
>
  <div
    class="snap-section"
    id="snap-hero"
    data-bg="#171c28"
    data-bg-light="#eef7ff"
  >
    <div class="snap-inner"><MyHero /></div>
  </div>

  <div
    class="snap-section"
    id="snap-about"
    data-bg="#1c1528"
    data-bg-light="#f3eeff"
  >
    <div class="snap-inner"><AboutSections /></div>
  </div>

  <div
    class="snap-section"
    id="snap-contact"
    data-bg="#111e26"
    data-bg-light="#edf5f7"
  >
    <div class="snap-inner">
      <Contact />
      <Footer />
    </div>
  </div>
</Base>

<script>
  document.documentElement.classList.add("snap-page");

  const sections = document.querySelectorAll<HTMLElement>(".snap-section");
  const header = document.getElementById("site-header");

  function hexToRgba(hex: string, alpha: number): string {
    const r = parseInt(hex.slice(1, 3), 16);
    const g = parseInt(hex.slice(3, 5), 16);
    const b = parseInt(hex.slice(5, 7), 16);
    return `rgba(${r}, ${g}, ${b}, ${alpha})`;
  }

  let currentSection: HTMLElement | null = null;

  function applyBg(section: HTMLElement) {
    const isLight =
      document.documentElement.getAttribute("data-theme") === "light";
    const bg = isLight
      ? (section.dataset.bgLight ?? section.dataset.bg)
      : section.dataset.bg;
    if (!bg) return;
    document.documentElement.style.backgroundColor = bg;
    if (header) header.style.backgroundColor = hexToRgba(bg, 0.85);
  }

  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          currentSection = entry.target as HTMLElement;
          applyBg(currentSection);
        }
      });
    },
    { threshold: 0.4 },
  );

  sections.forEach((s) => observer.observe(s));

  // Re-apply bg whenever the theme attribute changes
  new MutationObserver(() => {
    if (currentSection) applyBg(currentSection);
  }).observe(document.documentElement, {
    attributes: true,
    attributeFilter: ["data-theme"],
  });
</script>

<style is:global>
  /* ===== SNAP LAYOUT — home page only ===== */
  html.snap-page {
    scroll-snap-type: y mandatory;
    transition: background-color 0.7s ease;
  }

  /* Strip layout wrapper padding/constraints */
  html.snap-page #app-wrapper {
    padding-top: 0 !important;
  }

  /* Hide the layout footer — it lives inside the Contact snap section instead */
  html.snap-page #app-wrapper > #footer {
    display: none;
  }

  /* Stretch the contact section's inner to full height so footer sits at bottom */
  html.snap-page #snap-contact {
    align-items: stretch;
  }

  html.snap-page #snap-contact .snap-inner {
    display: flex;
    flex-direction: column;
  }

  html.snap-page #snap-contact .snap-inner #footer {
    margin-top: auto;
  }

  html.snap-page #main-content {
    padding: 0 !important;
    max-width: 100% !important;
    margin: 0 !important;
    align-items: stretch !important;
  }

  html.snap-page #main-content > section {
    padding: 0 !important;
    max-width: 100% !important;
    align-items: stretch !important;
  }

  /* ===== SNAP SECTIONS ===== */
  html.snap-page .snap-section {
    scroll-snap-align: start;
    scroll-snap-stop: always;
    min-height: 100vh;
    display: flex;
    align-items: flex-start;
    width: 100%;
    /* Side padding mirrors original #main-content */
    padding: 0 20px;
  }

  /* ===== INNER CONTENT — respects max-width like before ===== */
  html.snap-page .snap-inner {
    width: 100%;
    max-width: 1000px;
    margin: 0 auto;
    /* Top pad: 64px navbar + comfortable vertical space */
    padding-top: 80px;
    padding-bottom: 40px;
  }

  @media screen and (min-width: 720px) {
    html.snap-page .snap-section {
      padding: 0 40px;
    }
  }

  @media screen and (min-width: 900px) {
    html.snap-page .snap-section {
      padding: 0 60px;
    }
  }

  @media screen and (min-width: 1300px) {
    html.snap-page .snap-section {
      padding: 0 80px;
    }
  }
</style>
